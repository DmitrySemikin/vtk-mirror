#!/bin/bash
# check if oprofile and oreport is installed
hash operf 2>/dev/null || { echo >&2 "I require operf but it's not installed.  Aborting."; exit 1; }
hash opreport 2>/dev/null || { echo >&2 "I require opreport but it's not installed.  Aborting."; exit 1; }


BIN_PATH=../../../bin/
TEST_PROGRAM_NAME="SMPThreadedImageAlgorithm"
THREAD_NUMBER=4
SPLIT_SMP_BLOCKS=500
NUMBER_OF_ITERATIONS=4
WORK_LOAD=5000
ENABLESMP="true"
O_PERF_EVENTS=""
#O_PERF_EVENTS="CPU_CLK_UNHALTED:100000,L2_LINES_IN:100000:0xf0" #This depends on the cpu configuration

REPORT_NAME=Run:${TEST_PROGRAM_NAME}-${THREAD_NUMBER}-${SPLIT_SMP_BLOCKS}-${NUMBER_OF_ITERATIONS}-${WORK_LOAD}
echo $REPORT_NAME

for i in {0..2..1}
do
     operf $O_PERF_EVENTS $BIN_PATH$TEST_PROGRAM_NAME $THREAD_NUMBER $SPLIT_SMP_BLOCKS $NUMBER_OF_ITERATIONS $WORK_LOAD $ENABLESMP
     opreport --callgraph -o ${REPORT_NAME}.txt
done
